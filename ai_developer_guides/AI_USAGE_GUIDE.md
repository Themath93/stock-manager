# AI 활용 가이드 (전략 생성 · 매매일지)

이 문서는 자동매매 시스템에서 AI를 언제, 어떻게 사용하는지 정의한다. **AI는 작성자 역할**이며, **DB는 진실의 원천**이다. 모든 AI 결과는 검증/승인 절차를 거쳐 반영한다.

---

## 1. 적용 범위

- **전략 파라미터 생성(EOD/야간 배치)**
- **매매일지 작성(장 종료 후 배치)**

AI는 실시간 주문 의사결정에 직접 개입하지 않는다.

---

## 2. 공통 원칙

- **검증 우선**: AI 결과는 규칙 검증(범위, 일관성) 통과 후에만 DB 반영
- **상태 분리**: Draft → Approved 상태를 구분하여 운영 리스크를 낮춤
- **근거 저장**: AI가 참고한 데이터 스냅샷/요약을 함께 저장
- **감사 가능성**: 프롬프트/응답/모델/타임스탬프를 기록
- **안전 방향**: 불확실하면 “거래 중지/관찰 모드” 쪽으로 처리

---

## 3. 전략 파라미터 생성 흐름

### 3.1 입력 데이터

- 전일/최근 N일 거래 성과(수익, MDD, 승률 등)
- 시장 지표(변동성, 거래대금, 지수 변동 등)
- 리스크 한도 및 정책(일 손실 한도, 종목별 노출 등)
- 전략별 기존 파라미터 및 성과 로그

### 3.2 AI 출력 형식(예시)

- 전략별 파라미터 JSON
- 변경 이유 요약(근거)
- 리스크 영향 요약

### 3.3 검증 규칙(예시)

- 값 범위: min/max 제한
- 상호 제약: 예) 손절폭 < 익절폭
- 일관성: 기존 정책/리스크 한도 위반 금지

### 3.4 승인 및 반영

- **Draft 저장** → 검증 통과 → **Approved** → `strategy_params` ACTIVE Insert
- 승인 실패 시: Draft 유지 + 알림

---

## 4. 매매일지 작성 흐름

### 4.1 입력 데이터

- 당일 주문/체결 기록
- 포지션 변동
- 수익/손실 요약
- 리스크 위반/차단 기록

### 4.2 AI 출력 형식(예시)

- 일일 요약(시장/전략/성과)
- 핵심 트레이드 리뷰
- 리스크 이벤트 정리
- 개선 포인트/내일 가정

### 4.3 저장 정책

- `trade_journals` 테이블(권장) 또는 `events` 확장 테이블에 기록
- 원문 + 구조화 요약 동시 저장

---

## 5. 추천 테이블(확장)

테이블 DDL의 단일 기준은 `ai_developer_guides/DB_SCHEMA_DDL.md`이다.

### 5.1 strategy_param_drafts

- `id`, `strategy_id`, `trade_date`, `version`, `params`, `status(DRAFT/REVIEW/APPROVED/REJECTED)`
- `ai_model`, `prompt_hash`, `input_snapshot`, `created_at`

### 5.2 trade_journals

- `id`, `trade_date`, `summary`, `details`, `metrics_json`, `ai_model`, `created_at`

### 5.3 ai_job_runs

- `id`, `job_type`, `model`, `prompt`, `response`, `status`, `created_at`

---

## 6. 운영 스케줄(예시)

- **15:40 ~ 16:00**: 매매일지 생성
- **18:00 ~ 20:00**: 전략 파라미터 생성
- 승인 실패 시 자동 재시도는 제한적으로 수행

---

## 7. 보안 및 안정성

- API 키는 환경변수로 관리
- AI 응답은 반드시 JSON 스키마 검증
- 모델 변경 시 회귀 테스트 수행
