# 자동매매 봇 아이디어 정리

이 문서는 현재까지 논의된 아이디어를 실행 전에 빠르게 확인할 수 있도록 정리한 초안이다.

---

## 1. 일일 운영 시나리오 (요약)

- 장 시작 전: 설정 로드, 토큰 발급, 유니버스 확정, 상태 복구
- 장중: 실시간 이벤트 기반 신호 계산, 리스크 체크 후 주문
- 장 종료 후: 거래 기록 정리, 매매일지 작성
- 야간: 다음날 전략 파라미터 생성/검증/승인

---

## 2. 종목 선택 방식 (혼합 유니버스)

- 기본 유니버스: DB에 등록된 고정 관심 종목
- 동적 유니버스: 당일 REST 스캔으로 후보 추가
- 운영 원칙:
  - 실시간 구독은 유니버스 종목만
  - 동적 후보는 하루 단위 TTL 적용
  - 유니버스 변경 횟수/종목 수 상한 설정

---

## 3. 실시간 판단 방식

- 실시간 체결/호가 이벤트 수신 → 해당 종목 신호 평가
- 전략 타임프레임에 따라 평가 주기를 다르게 설정
  - 틱 기반: 이벤트마다 평가
  - 분봉 기반: 캔들 완료 시점 평가
- 폴링은 보조(헬스체크, 누락 보정)에만 사용

---

## 4. AI 활용

- 전략 파라미터 생성: 야간 배치로 AI가 초안 생성
- 매매일지 작성: 장 종료 후 AI가 요약/회고 작성
- 공통 원칙: Draft → 검증 → 승인 후 DB 반영

---

## 5. 브로커 전환 (한국투자증권 오픈API)

- REST + WebSocket 사용
- 인증: REST access_token, WebSocket approval_key
- 실전/모의 엔드포인트 분리
- TLS 1.2/1.3만 허용

---

## 6. 리스크 및 안정성

- 실패 시 거래 중지 방향
- 주문/체결 상태 복구가 핵심
- 모든 주문/체결/에러는 DB 기록
- updated_at 자동 갱신 트리거 적용

---

## 7. 남은 결정 사항

- 유니버스 최대 종목 수
- 당일 스캔 기준(거래대금/변동성/갭 등)
- AI 결과 승인 방식(자동/수동)
- 전략 파라미터 범위 규칙

---

## 8. PoC/MVP 아이디어: 로그 기반 리플레이

PoC 단계에서는 DB 정규화보다 **로그(append-only) 기반 재현**이 빠르고 안전하다.

- 로그 포맷: JSONL (하루 단위 롤링)
- 저장 위치: `logs/ledger_YYYYMMDD.jsonl`
- 목적: 전략 판단 근거 재현, 디버깅, AI 전략 검증

최소 이벤트 타입:
- `market_snapshot` (신호 계산 시점 가격/호가 스냅샷)
- `signal` (매수/매도 판단 결과)
- `risk_check` (통과/차단 결과)
- `order_intent` (주문 생성 의도)
- `order_sent` (브로커 전송)
- `order_update` (주문 상태 변경)
- `fill` (체결 결과)
- `position_update` (포지션 변경)

기본 필드 예시:
- `ts` (KST ISO8601)
- `event_type`
- `symbol`
- `strategy_id`, `param_version`
- `side`, `qty`, `price`
- `order_id`, `broker_order_id`
- `risk_result`, `reason`
- `snapshot` (bid/ask/last 등 최소)
- `correlation_id` (트레이드 단위 묶음)
